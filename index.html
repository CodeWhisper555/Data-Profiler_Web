<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTELLIGENCE TERMINAL | DATA INGESTION</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Roboto+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-primary: #0A0C10;
            --bg-secondary: #101214;
            --accent-blue: #007BFF;
            --border-color: #30363D;
            --text-main: #E6E6E6;
            --text-muted: #8B949E;
        }

        /* Global Reset */
        body {
            background-color: var(--bg-primary);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar - Industrial Minimalism */
        .sidebar {
            width: 320px;
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        .brand {
            font-weight: 600;
            letter-spacing: 2px;
            font-size: 14px;
            color: var(--accent-blue);
            margin-bottom: 20px;
            font-family: 'Roboto Mono', monospace;
        }

        .upload-zone {
            border: 1px dashed var(--border-color);
            padding: 40px 20px;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.3s;
        }

        .upload-zone:hover {
            border-color: var(--accent-blue);
            background: rgba(0, 123, 255, 0.05);
        }

        /* Main Content Stage */
        .main-stage {
            flex-grow: 1;
            padding: 40px;
            overflow-y: auto;
            background: radial-gradient(circle at top right, #161b22, #0A0C10);
            transition: box-shadow 0.5s ease-in-out;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 40px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
        }

        h1 { font-size: 24px; font-weight: 300; margin: 0; letter-spacing: -0.5px; text-transform: uppercase; }

        /* Stats Architecture */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        .stat-value {
            font-family: 'Roboto Mono', monospace;
            font-size: 24px;
            color: var(--accent-blue);
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-muted);
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        /* System Buttons */
        .btn {
            background: #21262D;
            border: 1px solid var(--border-color);
            color: var(--text-main);
            padding: 12px 16px;
            font-size: 11px;
            border-radius: 4px;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            transition: 0.2s;
        }

        .btn:hover { background: #30363D; border-color: var(--text-muted); }
        .btn-primary { background: var(--accent-blue); border: none; color: white; }
        .btn-primary:hover { background: #0056b3; }

        /* Data Visualization & Tables */
        #chartWrapper {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            background: rgba(16, 18, 20, 0.5);
        }

        th { 
            text-align: left; 
            background: #161b22;
            color: var(--accent-blue); 
            border-bottom: 1px solid var(--border-color); 
            padding: 12px; 
            font-family: 'Roboto Mono', monospace;
            font-size: 11px;
        }

        td { padding: 12px; border-bottom: 1px solid #161b22; }
        tr:hover { background: rgba(255, 255, 255, 0.02); }

        /* Animations & Indicators */
        @keyframes pulse-blue {
            0% { box-shadow: inset 0 0 0 0 rgba(0, 123, 255, 0.1); }
            70% { box-shadow: inset 0 0 20px 0 rgba(0, 123, 255, 0.2); }
            100% { box-shadow: inset 0 0 0 0 rgba(0, 123, 255, 0.1); }
        }

        .processing { animation: pulse-blue 2s infinite; }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background-color: #238636; box-shadow: 0 0 5px #238636; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 10px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">CORE_TERMINAL_v4.1</div>
        
        <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
            <div style="font-size: 10px; color: var(--text-muted); letter-spacing: 1px;">DRAG_DROP OR CLICK</div>
            <div style="font-size: 12px; margin-top: 8px; font-weight: 600;">SOURCE_CSV_INGESTION</div>
            <input type="file" id="fileInput" hidden accept=".csv">
        </div>

        <div id="controls" style="display: none;">
            <p class="stat-label">Automation</p>
            <button class="btn" onclick="cleanData()" style="width: 100%; margin-bottom: 10px;">Execute Sanitization</button>
            <button class="btn" onclick="downloadCSV()" style="width: 100%; margin-bottom: 10px;">Export Clean Stream</button>
            
            <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 20px 0;">
            
            <p class="stat-label">Compute Node</p>
            <button class="btn btn-primary" onclick="window.open('YOUR_STREAMLIT_URL_HERE')" style="width: 100%;">Connect to Analytics Node</button>
        </div>
    </div>

    <div class="main-stage">
        <div class="header-row">
            <div>
                <p class="stat-label">Ingestion Interface</p>
                <h1>DIAGNOSTIC_OVERVIEW</h1>
            </div>
            <div id="status" style="font-family: 'Roboto Mono'; color: var(--text-muted); font-size: 11px; letter-spacing: 0.5px;">SYSTEM_STANDBY</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Record Count</div>
                <div id="rowCount" class="stat-value">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Integrity Index</div>
                <div id="integrityScore" class="stat-value">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Null Vectors</div>
                <div id="nullCount" class="stat-value">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ingestion Latency</div>
                <div id="loadTime" class="stat-value">0ms</div>
            </div>
        </div>

        <div id="chartWrapper" style="display: none;">
            <p class="stat-label">Primary Feature Distribution Preview</p>
            <canvas id="distributionChart" height="80"></canvas>
        </div>

        <div id="tableWrapper"></div>
    </div>

    <script>
        let rawData = [];
        let headers = [];

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const startTime = performance.now();
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                const text = event.target.result;
                
                // MCN-Grade Fix: Split rows while handling different OS line endings
                const rows = text.split(/\r?\n/);
                
                // Robust Regex: Only split by commas NOT enclosed in double quotes
                const csvRegex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;

                // Process Headers: Split and remove extra quotes
                headers = rows[0].split(csvRegex).map(h => h.replace(/"/g, '').trim());
                
                rawData = [];
                for(let i = 1; i < rows.length; i++) {
                    if (!rows[i].trim()) continue; // Skip empty lines
                    
                    // Process Row: Split and remove quotes from each cell
                    const cols = rows[i].split(csvRegex).map(c => c.replace(/"/g, '').trim());
                    
                    // Integrity Check: Only accept rows matching header count
                    if(cols.length === headers.length) {
                        rawData.push(cols);
                    }
                }

                updateUI(startTime);
                renderChart();
            };
            reader.readAsText(file);
        });

        function updateUI(startTime) {
            const mainStage = document.querySelector('.main-stage');
            mainStage.classList.add('processing');

            // 1. Calculations
            const totalCells = rawData.length * headers.length;
            const nulls = rawData.flat().filter(cell => !cell || cell.trim() === "" || cell === "NA").length;
            
            const numericFeatures = headers.filter((_, index) => {
                const sampleRow = rawData.find(r => r[index] !== "");
                const sample = sampleRow ? sampleRow[index] : null;
                return sample !== null && !isNaN(parseFloat(sample)) && isFinite(sample);
            }).length;

            // 2. Metric Updates
            document.getElementById('rowCount').innerText = rawData.length.toLocaleString();
            document.getElementById('nullCount').innerText = nulls.toLocaleString();
            
            const integrity = totalCells > 0 ? Math.max(0, 100 - (nulls / totalCells * 100)).toFixed(2) : "0";
            document.getElementById('integrityScore').innerText = integrity + '%';

            // 3. Status Updates
            const latency = Math.round(performance.now() - startTime);
            document.getElementById('loadTime').innerText = latency + 'ms';

            document.getElementById('status').innerHTML = 
                `<span class="status-indicator status-online"></span>` + 
                `NODE_READY | LATENCY: ${latency}ms | VECTORS: ${numericFeatures}n / ${headers.length - numericFeatures}c`;

            // 4. UI State
            document.getElementById('controls').style.display = 'block';
            document.getElementById('chartWrapper').style.display = 'block';
            
            setTimeout(() => mainStage.classList.remove('processing'), 800);
            renderTable();
        }

        function renderTable() {
            let html = `<table><thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead><tbody>`;
            rawData.slice(0, 10).forEach(row => {
                html += `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`;
            });
            html += '</tbody></table>';
            document.getElementById('tableWrapper').innerHTML = html + 
                `<p style="color: var(--text-muted); font-size: 10px; margin-top: 12px; font-family: 'Roboto Mono'; text-transform: uppercase;">` +
                `[SYSTEM_LOG]: DATA_SAMPLED_TOP_10_RECORDS_FOR_PREVIEW</p>`;
        }

        function renderChart() {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            const firstNumIdx = headers.findIndex((_, i) => !isNaN(parseFloat(rawData[0][i])));
            if (firstNumIdx === -1) return;

            const numericData = rawData.map(r => parseFloat(r[firstNumIdx])).filter(v => !isNaN(v));
            
            if (window.myChart) window.myChart.destroy();
            
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: numericData.slice(0, 50).map((_, i) => i),
                    datasets: [{
                        label: 'Feature Intensity',
                        data: numericData.slice(0, 50),
                        borderColor: '#007BFF',
                        backgroundColor: 'rgba(0, 123, 255, 0.05)',
                        borderWidth: 1.5,
                        pointRadius: 0,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { grid: { color: '#161b22' }, ticks: { color: '#8B949E', font: { size: 9 } } }
                    }
                }
            });
        }

        function cleanData() {
            const start = performance.now();
            rawData = rawData.filter(row => !row.some(cell => !cell || cell.trim() === "" || cell === "NA"));
            updateUI(start);
        }

        function downloadCSV() {
            // Re-wrapping values in quotes for safe CSV export
            const csvContent = "data:text/csv;charset=utf-8," + 
                headers.map(h => `"${h}"`).join(",") + "\n" + 
                rawData.map(row => row.map(cell => `"${cell}"`).join(",")).join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "sanitized_dataset.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>
